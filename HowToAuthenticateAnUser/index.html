<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>How To Authenticate An User - Organicity Tech Docs</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
			<a class="navbar-brand active" href="..">
				<img alt="Organicity Tech Docs" src="https://organicityeu.github.io/api/static/img/oc_logo.png">Tech Docs
			</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">architecture <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../AssetCRUD/">Asset CRUD</a>
</li>
                            
<li >
    <a href="../AssetDataModel/">Asset Data Model</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">services <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../AssetDiscoveryService/">Asset Discovery Service</a>
</li>
                            
<li >
    <a href="../AssetAnnotationService/">Asset Annotation Service</a>
</li>
                            
<li >
    <a href="../ExperimenterPortal/">Experimenter Portal</a>
</li>
                            
<li >
    <a href="../FederatedDataAssets/">Federated Data Assets</a>
</li>
                            
<li >
    <a href="../UrbanDataObservatory/">Urban Data Observatory</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../HowToAccessToken/">How To Access Token</a>
</li>
                            
<li class="active">
    <a href="./">How To Authenticate An User</a>
</li>
                            
<li >
    <a href="../HowToOcSite/">How To Oc Site</a>
</li>
                            
<li >
    <a href="../HowToPushAnAsset/">How To Push An Asset</a>
</li>
                            
<li >
    <a href="../HowToPushAnAssetToTheExperimenterSite/">How To Push An Asset To The Experimenter Site</a>
</li>
                            
<li >
    <a href="../HowToPushAnAssetToTheProviderSite/">How To Push An Asset To The Provider Site</a>
</li>
                            
<li >
    <a href="../HowToRefreshToken/">How To Refresh Token</a>
</li>
                            
<li >
    <a href="../HowToUpdateDeteleAnAsset/">How To Update Detele An Asset</a>
</li>
                        </ul>
                    </li>
				
				  
				    <li><a href="https://organicityeu.github.io/api/">api's</a></li>
				  
				    <li><a href="https://status.organicity.eu/">status</a></li>
				  
				
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../HowToAccessToken/">
                            <i class="fa fa-arrow-left"></i>
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../HowToOcSite/">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/organicityeu">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#tutorial-how-to-authenticate-a-user-for-your-application">Tutorial: How to Authenticate a User for your Application</a></li>
            <li><a href="#todo">TODO</a></li>
            <li><a href="#oauth2-grants">OAuth2 Grants</a></li>
            <li><a href="#client-id-client-secret">Client ID + Client Secret</a></li>
            <li><a href="#grant-types">Grant Types</a></li>
            <li><a href="#libraries">Libraries</a></li>
            <li><a href="#sources-on-oauth2">Sources on OAuth2</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="tutorial-how-to-authenticate-a-user-for-your-application">Tutorial: How to Authenticate a User for your Application</h1>
<p><strong>Goal of this tutorial</strong>:</p>
<ul>
<li>Authenticate a user for your own application with <a href="https://accounts.organicity.eu"><em>Organicity Accounts</em></a>.</li>
</ul>
<p><strong>Preconditions</strong>:
<em> To be able to authenticate users for your application, you must have the role <code>experimenter</code> assigned.
</em> You created an experiment within the <a href="http://experimenters.organicity.eu/">Organicity Experimenter Portal</a>.
* The Experimenter Portal provides you a <code>client_id</code> and a <code>client_secret</code>, both is needed in this tutorial.</p>
<p><a href="https://accounts.organicity.eu">Organicity Accounts</a> provides unified user management to the whole Organicity platform. Of course, a unified experience requires all Organicity components to properly talk to Organicity Accounts. This document guides through the process of setting your component up.</p>
<h2 id="todo">TODO</h2>
<ul>
<li>Scopes</li>
<li>Refresh_token</li>
</ul>
<h2 id="oauth2-grants">OAuth2 Grants</h2>
<p><a href="https://accounts.organicity.eu/">Organicity Accounts</a> is an <a href="https://tools.ietf.org/html/rfc6749">OAuth2 server</a>, which provides a Single Sign-On (SSO) service. Thus, you can login to
all Organicity Components by using one single account. In case of web-applications, you even just need to login once.
Probably you know this from Google: To use gmail, youtube or the calendar, you use the same account.</p>
<!--
## Roles

To use Organicity Accounts, OAuth2 provides different Roles:

* Client: This is your application. Within OAuth2, it is called *Client*
* User: The user, who wants to login to your application
* Resource Server:
* Authorization Server
-->

<h2 id="client-id-client-secret">Client ID + Client Secret</h2>
<p>After creating your experiment within the <a href="http://experimenters.organicity.eu/">Experimenter Portal</a>, you will receive a <code>client_id</code> and a <code>client_secret</code>:</p>
<ul>
<li>The <code>client_id</code> is public, so it can be added to the source code, which is uses it to build a login URL finally.</li>
<li>The <code>client_secret</code> is private and must be kept confidential!</li>
</ul>
<h2 id="grant-types">Grant Types</h2>
<p><a href="https://tools.ietf.org/html/rfc6749">The OAuth2 specification</a> provides several <em>Grant Types</em> for different types of applications:</p>
<ul>
<li><strong>Authorization Code Grant</strong>: Used for web-applications with a server-side component, which can keep the <code>client_id</code> confidential.</li>
<li><strong>Implicit Grant</strong>: Used for browser-based applications (e.g., JavaScript-only applications without a server-side component) or mobile apps.</li>
</ul>
<p>In this two grants, after a successful login, the applications will act <strong>in name of the user</strong>. There is one more important grant:</p>
<ul>
<li><strong>Client Credential Grant</strong>: Only used for application, which <strong>act on their own</strong>.</li>
</ul>
<p>Per default, this grant ist not enabled for experiments.</p>
<h3 id="endpoints">Endpoints</h3>
<p>The following endpointd are needed by the grants described below:</p>
<ul>
<li><em>Authorization Endpoint</em>: https://accounts.organicity.eu/realms/organicity/protocol/openid-connect/auth</li>
<li><em>Token Endpoint</em>: https://accounts.organicity.eu/realms/organicity/protocol/openid-connect/token</li>
</ul>
<h3 id="authorization-code-grant">Authorization Code Grant</h3>
<p>As said before, this grant is used for applications running on a web server. Thus, the source code of the web-application
keeps the <code>client_secret</code> confidential. This grant is divided in two flows:</p>
<p>For the <em>first flow</em>, you must extend the authorization endpoint with the following
query parameters:</p>
<ul>
<li><code>client_id=&lt;CLIENT_ID&gt;</code>: Here, you must include your <code>client_id</code>, which is provided by the Experimenter Portal</li>
<li><code>response_type=code</code>: Here, the response type must be <code>code</code></li>
<li><code>redirect_uri=&lt;REDIRECT_URI&gt;</code>: Within the Experimenter Portal, you can configure Redirect URIs. After a successful login, the user is redirected to that URI.</li>
</ul>
<p><strong>HINT</strong>: Make sure, that you're web-application, and thus the <code>redirect_uri</code>, runs on HTTPS. This ensures, that the exchanged data cannot be intercepted during the login process.</p>
<p>Thus, the full authorization URL looks as follows:</p>
<pre><code class="shell">https://accounts.organicity.eu/realms/organicity/protocol/openid-connect/auth?client_id=&lt;CLIENT_ID&gt;&amp;response_type=code&amp;redirect_uri=&lt;REDIRECT_URI&gt;
</code></pre>

<p>An example:</p>
<pre><code class="shell">https://accounts.organicity.eu/realms/organicity/protocol/openid-connect/auth?client_id=example&amp;response_type=code&amp;redirect_uri=https://example.com/callback
</code></pre>

<p>Calling this URL, the users must login with their credentials. If the login is successful, the user is redirected back to the configured redirect URI.
OAuth2 appends one parameter to the URL:</p>
<ul>
<li><code>code</code>: This is the so called <strong>authorization_code</strong>, which is needed in the next step.</li>
</ul>
<p>Thus, the full callback URL looks as follows:</p>
<pre><code class="shell">&lt;REDIRECT_URI&gt;?code=&lt;CODE&gt;
</code></pre>

<p>An example:</p>
<pre><code class="shell">https://example.com/callback?code=0123456789
</code></pre>

<p>Now, the <em>second flow</em> starts. You're web-application takes this <code>code</code> and must send an HTTP POST request to the
<em>token endpoint</em>, with the following parameters:</p>
<ul>
<li><code>client_id=&lt;CLIENT_ID&gt;</code>: Here, you must include your <code>client_id</code>, which is provided by the Experimenter Portal</li>
<li><code>grant_type=authorization_code</code>: The <code>grant_type</code> must be <code>authorization_code</code>. Here you see, where the name comes from.</li>
<li><code>redirect_uri=&lt;REDIRECT_URI&gt;</code>: The same URI as before</li>
<li><code>code=&lt;CODE&gt;</code>: The code from the callback URL</li>
<li><code>client_secret=&lt;CLIENT_SECRET&gt;</code>: Here, you must include your <code>client_secret</code>, which is provided by the Experimenter Portal</li>
</ul>
<p><strong>HINT</strong>: Make sure, that this call is done from the web-application in the background, thus the <code>client_secret</code> stays confidential!</p>
<p>An example:</p>
<pre><code class="shell">TODO
</code></pre>

<p>Calling this URL, the server verifies your credentials and the code. If successful, the server returns a JSON, which contains the following attributes:</p>
<ul>
<li><code>token_type</code>: This is usually <code>Bearer</code></li>
<li><code>access_token</code>: this is the <strong>Access Token</strong> in JSON</li>
<li><code>expires_in</code>: a number in seconds, how long the Access Token is valid</li>
</ul>
<p>An example:</p>
<pre><code class="json">{
    &quot;access_token&quot;: &quot;&lt;ACCESS_TOKEN&gt;&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;expires_in&quot;: 300,
}
</code></pre>

<p><a href="../HowToAccessToken">See here for further details on the Access Tokens</a>.</p>
<h3 id="implicit-grant">Implicit Grant</h3>
<p><strong>HINT</strong>:</p>
<p>This grant is used for browser-based applications (e.g., JavaScript-only applications without a server-side component) or mobile apps.
These kind of applications cannot keep the <code>client_secret</code> confidential. The Implicit Grant has just one flow, which returns
the Access Token directly. The Grant is called <em>implicit</em>, as no intermediate credentials (such as an authorization code) are issued.</p>
<p>For this grant, you must extend the authorization endpoint with the following query parameters:</p>
<ul>
<li><code>client_id=&lt;CLIENT_ID&gt;</code>: Here, you must include your <code>client_id</code>, which is provided by the Experimenter Portal</li>
<li><code>response_type=token</code>: Here, the response type must be <code>token</code> (becaue you'll get an Access Token immediately)</li>
<li><code>redirect_uri=&lt;REDIRECT_URI&gt;</code>: Within the Experimenter Portal, you can configure Redirect URIs. After a successful login, the user is redirected to that URI.</li>
</ul>
<p><strong>HINT</strong>: Make sure, that you're web-application, and thus the <code>redirect_uri</code>, runs on HTTPS. This ensures, that the exchanged data cannot be intercepted during the login process.</p>
<p>Thus, the full authorization URL looks as follows:</p>
<pre><code class="shell">https://accounts.organicity.eu/realms/organicity/protocol/openid-connect/auth?client_id=&lt;CLIENT_ID&gt;&amp;response_type=token&amp;redirect_uri=&lt;REDIRECT_URI&gt;
</code></pre>

<p>An example:</p>
<pre><code class="shell">https://accounts.organicity.eu/realms/organicity/protocol/openid-connect/auth?client_id=example&amp;response_type=token&amp;redirect_uri=https://example.com/callback
</code></pre>

<p>Calling this URL, the users must login with their credentials. If the login is successful, the user is redirected back to the configured redirect URI.
OAuth2 appends one parameter to the URL:</p>
<ul>
<li><code>token</code>: This is the Access Token in JSON</li>
</ul>
<p>The JSON contains the following attributes (similar to the <em>Authorization Code Flow</em>):</p>
<ul>
<li><code>token_type</code>: This is usually <code>Bearer</code></li>
<li><code>access_token</code>: this is the <strong>Access Token</strong> itself</li>
<li><code>expires_in</code>: a number in seconds, how long the Access Token is valid</li>
</ul>
<p>An example:</p>
<pre><code class="json">{
    &quot;access_token&quot;: &quot;&lt;ACCESS_TOKEN&gt;&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;expires_in&quot;: 300,
}
</code></pre>

<p><a href="../HowToAccessToken">See here for further details on the Access Tokens</a>.</p>
<h3 id="client-credential-grant">Client Credential Grant</h3>
<p><strong>HINT:</strong> Per default, this grant ist not enabled for experiments.</p>
<p>The <strong>Client Credential Grant</strong> is used for applications, which <strong>act on their own</strong>. For this, the <em>Service Account</em> of the Client must be enabled.</p>
<p>Service Accounts usually apply for Organicity Accounts, but can also be used by e.g. experiments. To use a Service Account, you perform a simple HTTPS with your <code>client_id</code> and <code>client_secret</code> call, which will return a suitable Access Token:</p>
<pre><code class="shell">POST /realms/organicity/protocol/openid-connect/token HTTP/1.1
Host: accounts.organicity.eu
Authorization: Basic &lt;BASE64_ENCODE(client_id:client_secret)&gt;
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
</code></pre>

<p>The Authorization header contains your <code>client_id</code> and <code>client_secret</code> encoded with HTTP basic authentication. For details on how to create this field, <a href="https://en.wikipedia.org/wiki/Basic_access_authentication#Client_side">see here</a>.</p>
<p>The call returns a JSON record, which contains the following attributes:</p>
<ul>
<li><code>token_type</code>: This is usually <code>Bearer</code></li>
<li><code>access_token</code>: this is the <strong>Access Token</strong> itself</li>
<li><code>expires_in</code>: a number in seconds, how long the Access Token is valid</li>
</ul>
<p>An example:</p>
<pre><code class="json">{
    &quot;access_token&quot;: &quot;&lt;ACCESS_TOKEN&gt;&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;expires_in&quot;: 300,
}
</code></pre>

<p><a href="../HowToAccessToken">See here for further details on the Access Tokens</a>.</p>
<h2 id="libraries">Libraries</h2>
<p>Of course, you do not have to write you're own OAuth2 adapter. You can use well-tested existing librabries, like the following:</p>
<ul>
<li>Node.js with Passport: <a href="https://github.com/jaredhanson/passport-oauth2">passport-oauth2</a></li>
<li>PHP: <a href="https://github.com/thephpleague/oauth2-client">oauth2-client</a></li>
</ul>
<p>For these two, we created two minimal working examples:</p>
<ul>
<li>Node.js with Passport:  <a href="https://github.com/OrganicityEu/accounts-demo-passport">accounts-demo-passport</a></li>
<li>PHP: <a href="https://github.com/OrganicityEu/accounts-demo-php">accounts-demo-php</a></li>
</ul>
<p>In order to talk to Organicity Accounts, your component needs to talk to the Accounts Server using any of the above mentioned grants.</p>
<h2 id="sources-on-oauth2">Sources on OAuth2</h2>
<ul>
<li>https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2</li>
<li>https://alexbilbie.com/guide-to-oauth-2-grants/</li>
<li>https://aaronparecki.com/2012/07/29/2/oauth2-simplified</li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p class="small">This project has received funding from the European Union's Horizon 2020 research and innovation program under the grant agreement No. 645198</p>
                  <img alt="This project has received funding from the European Union's Horizon 2020 research and innovation program under the grant agreement No. 645198" src="http://organicity.eu/wp-content/themes/organicity/images/logo_eu.png">            
            <p class="small">Last update 2017-03-09 14:02:34 built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>
        <script src="../api/static/js/cropbox-min.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>